<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stage 6 Science • Units 2 & 5 • Extended Practice App</title>
<style>
  :root{
    --bg:#0f172a;/* slate-900 */
    --card:#111827ee;/* gray-900 */
    --muted:#94a3b8;/* slate-400 */
    --text:#e5e7eb;/* gray-200 */
    --accent:#22d3ee;/* cyan-400 */
    --good:#34d399;/* green-400 */
    --bad:#f87171;/* red-400 */
    --warn:#fbbf24;/* amber-400 */
  }
  html,body{height:100%}
  body{margin:0;background:linear-gradient(145deg,#0b1024,#0e1a35 40%,#0b1024);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  header{display:flex;gap:18px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{font-size:clamp(22px,2.2vw,30px);margin:0;letter-spacing:.5px}
  .badge{font-weight:600;color:#0b1024;background:linear-gradient(120deg,#a7f3d0,#67e8f9);padding:6px 10px;border-radius:999px}
  .panel{background:var(--card);backdrop-filter: blur(6px);border:1px solid #1f2937;border-radius:18px;padding:16px}
  .controls{display:grid;grid-template-columns: repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  select,input[type="number"],input[type="text"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #334155;background:#0b1225;color:var(--text)}
  button{appearance:none;border:1px solid #2dd4bf;background:linear-gradient(120deg,#155e75,#0e7490);color:#ecfeff;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
  button.ghost{border-color:#334155;background:#0b1225;color:var(--text)}
  button:disabled{opacity:.5;cursor:not-allowed}
  .actions{display:flex;flex-wrap:wrap;gap:8px}
  .qcard{background:#0b1225;border:1px solid #1f2a44;border-radius:18px;padding:14px;margin:12px 0}
  .qhead{display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
  .qmeta{font-size:12px;color:var(--muted)}
  .qtext{margin:.4rem 0 .8rem;font-size:17px}
  .opts{display:grid;gap:8px}
  .opt{display:flex;gap:8px;align-items:flex-start;border:1px solid #263453;background:#0a1430;border-radius:12px;padding:10px}
  .opt input{margin-top:2px}
  .ans{margin-top:8px;border-left:4px solid var(--accent);padding:8px 12px;background:#071024;border-radius:10px}
  .ans.good{border-left-color:var(--good)}
  .ans.bad{border-left-color:var(--bad)}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;margin-right:6px;border:1px solid #334155}
  .mcq .opt:hover{outline:1px dashed #334155}
  .tag{font-size:11px;color:#67e8f9}
  .footer{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:12px}
  .score{font-weight:800}
  .hidden{display:none}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0b1225;border:1px solid #27324a;padding:2px 6px;border-radius:6px}
  .print-note{font-size:12px;color:var(--muted)}
  .hl{color:#f9fafb;background:#1f2937;padding:0 6px;border-radius:6px}
  @media print{
    body{background:white;color:black}
    .panel,.qcard{page-break-inside:avoid}
    .actions,#config,.footer{display:none !important}
    .ans{display:block !important}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Cambridge Primary Science • Stage 6 • Units 2 & 5</h1>
      <span class="badge">Extended Practice Paper (120+ Questions)</span>
    </header>

    <section class="panel" id="config">
      <div class="grid">
        <div>
          <label for="mode">Mode</label>
          <select id="mode">
            <option value="practice">Practice (auto-marking)</option>
            <option value="read">Reading / Revision (show answers)</option>
            <option value="quiz">Timed Quiz</option>
          </select>
        </div>
        <div>
          <label for="unit">Unit</label>
          <select id="unit">
            <option value="all">All Units</option>
            <option value="2">Unit 2: Materials, properties & changes</option>
            <option value="5">Unit 5: Force & electricity</option>
          </select>
        </div>
        <div>
          <label for="topic">Topic</label>
          <select id="topic">
            <option value="all">All Topics</option>
          </select>
        </div>
        <div>
          <label for="difficulty">Difficulty</label>
          <select id="difficulty">
            <option value="all">All</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>
        <div>
          <label for="count"># Questions</label>
          <input type="number" id="count" min="1" max="80" value="25" />
        </div>
        <div>
          <label for="search">Keyword filter <span class="print-note">(optional)</span></label>
          <input type="text" id="search" placeholder="e.g., friction, series, dissolving"/>
        </div>
      </div>
      <div class="actions" style="margin-top:12px">
        <button id="generate">Generate Paper</button>
        <button class="ghost" id="shuffle">Shuffle</button>
        <button class="ghost" id="print">Print / Save PDF</button>
        <button class="ghost" id="exportPdf">Export Model Answer Sheet (PDF)</button>
        <span class="print-note">Tip: Use <span class="kbd">Ctrl/Cmd + P</span> to export a neat PDF.</span>
      </div>
    </section>

    <section class="panel" id="paper"></section>

    <section class="panel footer">
      <div>
        <span class="pill">Score: <span class="score" id="score">0</span></span>
        <span class="pill">Time: <span id="timer">00:00</span></span>
        <span class="pill">Answered: <span id="answered">0</span></span>
      </div>
      <div class="actions">
        <button id="showAll">Reveal All</button>
        <button class="ghost" id="reset">Reset</button>
      </div>
    </section>
  </div>

<script>
/**
 * Extended Question Bank Generator (120+ items)
 * We combine a curated base with generated variants to exceed 140 Qs.
 */

// Topic lists
const TOPICS = {
  2:["2.1 Properties of substances","2.2 Thermal & electrical conductors","2.3 Reversible changes","2.4 Chemical changes"],
  5:["5.1 Mass & weight","5.2 Effects of forces","5.3 Floating & sinking","5.4 Circuits & diagrams"],
};

// === Curated base (a compact selection across all topics; each with model answers) ===
const BASE = [
  // 2.1
  {id:"2.1-1", unit:2, topic:"2.1 Properties of substances", type:"mcq", difficulty:"medium", question:"Which pair lists a property and a correct example?", options:["Transparency – aluminium foil","Flexibility – copper wire","Hardness – diamond","Magnetism – plastic ruler"], answer:2, explanation:"Diamond is extremely hard. Aluminium foil is opaque; plastic is non-magnetic."},
  {id:"2.1-2", unit:2, topic:"2.1 Properties of substances", type:"reason", difficulty:"high", question:"R takes the shape of its container but cannot be compressed. Identify R and explain.", answer:"R is a liquid.", explanation:"Liquids take container shape and are nearly incompressible."},
  // 2.2
  {id:"2.2-1", unit:2, topic:"2.2 Thermal & electrical conductors", type:"classify", difficulty:"medium", question:"Classify: Rubber shoe, Copper bracelet, Wet cotton glove, Plastic spoon, Aluminium strip, Glass tray, Steel cable, Wooden table", answer:{conductors:["Copper bracelet","Aluminium strip","Steel cable","Wet cotton glove"], nonconductors:["Rubber shoe","Plastic spoon","Glass tray","Wooden table"]}, explanation:"Metals conduct; rubber/plastic/wood/glass insulate; wet cotton conducts via ions."},
  {id:"2.2-2", unit:2, topic:"2.2 Thermal & electrical conductors", type:"mcq", difficulty:"high", question:"Which statement is CORRECT about electrical safety?", options:["Wet hands lower resistance and increase shock risk","Rubber gloves increase current to ground","Metal ladders are safer near overhead lines","Bare feet improve insulation"], answer:0, explanation:"Water decreases resistance; rubber insulates; metal near lines is unsafe; bare feet reduce insulation."},
  // 2.3
  {id:"2.3-1", unit:2, topic:"2.3 Reversible changes", type:"mcq", difficulty:"medium", question:"Which change is reversible?", options:["Baking dough","Melting butter","Burning paper","Rusting iron"], answer:1, explanation:"Melting/freezing is reversible physical change."},
  {id:"2.3-2", unit:2, topic:"2.3 Reversible changes", type:"reason", difficulty:"high", question:"Sugar dissolves faster in hot tea than cold water. Explain using particle ideas.", answer:"Higher temperature → faster-moving particles → more collisions and faster dissolving.", explanation:"Kinetic theory."},
  // 2.4
  {id:"2.4-1", unit:2, topic:"2.4 Chemical changes", type:"mcq", difficulty:"medium", question:"Which observation BEST indicates a chemical change?", options:["Ice cube shrinking","Sugar dissolving","Formation of rust on iron","Water condensing on glass"], answer:2, explanation:"Rusting forms a new substance (iron oxide)."},
  {id:"2.4-2", unit:2, topic:"2.4 Chemical changes", type:"short", difficulty:"high", question:"State one method to prevent rusting of an iron gate and explain.", answer:"Paint or galvanise; paint blocks oxygen/water; zinc sacrificially protects iron.", explanation:"Barrier/sacrificial protection."},
  // 5.1
  {id:"5.1-1", unit:5, topic:"5.1 Mass & weight", type:"mcq", difficulty:"medium", question:"Which statement is TRUE?", options:["Mass changes on the Moon","Weight is a force caused by gravity","Mass is measured in newtons","Weight is the amount of matter"], answer:1, explanation:"Weight depends on gravity and is in newtons; mass is kg."},
  {id:"5.1-2", unit:5, topic:"5.1 Mass & weight", type:"short", difficulty:"high", question:"A 2 kg object on Earth has weight ~19.6 N. What is its weight on the Moon (≈1/6 g)?", answer:"≈3.3 N", explanation:"W = m × g; 19.6/6 ≈ 3.3 N."},
  // 5.2
  {id:"5.2-1", unit:5, topic:"5.2 Effects of forces", type:"mcq", difficulty:"medium", question:"Which is a non-contact force?", options:["Friction","Muscular","Magnetic","Air resistance"], answer:2, explanation:"Magnetic/gravity are non-contact."},
  {id:"5.2-2", unit:5, topic:"5.2 Effects of forces", type:"reason", difficulty:"medium", question:"A box is pushed with steady force yet moves at constant speed. Explain.", answer:"Push equals friction → net force 0 → constant velocity.", explanation:"Balanced forces."},
  // 5.3
  {id:"5.3-1", unit:5, topic:"5.3 Floating & sinking", type:"mcq", difficulty:"medium", question:"A metal key sinks in water mainly because:", options:["Gravity is stronger on it","It displaces less water than its weight","Water pushes it downward","It has air trapped"], answer:1, explanation:"If weight > upthrust, it sinks."},
  {id:"5.3-2", unit:5, topic:"5.3 Floating & sinking", type:"reason", difficulty:"high", question:"Explain why large steel ships float though steel is denser than water.", answer:"Ship encloses air → lowers average density below water → sufficient upthrust.", explanation:"Displacement principle."},
  // 5.4
  {id:"5.4-1", unit:5, topic:"5.4 Circuits & diagrams", type:"mcq", difficulty:"medium", question:"Which symbol pair is correct?", options:["Cell = circle with X; Switch = zig-zag","Cell = short & long lines; Switch = gap with lever","Bulb = triangle; Resistor = lamp symbol","Battery = three equal lines"], answer:1, explanation:"Cell short/long; switch break; bulb circle with cross."},
  {id:"5.4-2", unit:5, topic:"5.4 Circuits & diagrams", type:"short", difficulty:"high", question:"In a series circuit with two identical bulbs, what happens to brightness if one more bulb is added? Explain.", answer:"All bulbs dimmer: total resistance ↑ → current ↓.", explanation:"Series current same through all."},
];

// === Programmatic generators to expand to 140+ questions ===
const QUESTIONS = [...BASE];

function addMassWeightSet(){
  const masses = [0.5,1,1.5,2,3,4,5,6,8,10,12,20];
  masses.forEach((m,i)=>{
    const W = +(m*9.8).toFixed(1);
    QUESTIONS.push({id:`5.1-A-${i}`,unit:5,topic:"5.1 Mass & weight",type:"mcq",difficulty:"medium",
      question:`On Earth, the weight of a ${m} kg object is closest to:`,
      options:[`${(W/10).toFixed(1)} N`,`$${W} N`.replace('$',''),`${(W*2).toFixed(1)} N`,`${(W/2).toFixed(1)} N`],
      answer:1, explanation:`W = m × 9.8 ≈ ${W} N.`});
    const moonW = +(W/6).toFixed(1);
    QUESTIONS.push({id:`5.1-B-${i}`,unit:5,topic:"5.1 Mass & weight",type:"short",difficulty:"high",
      question:`Find the weight of a ${m} kg object on the Moon (≈1/6 g).`,
      answer:`≈ ${moonW} N`, explanation:`Moon g ≈ 1/6 of Earth → ${W}/6 ≈ ${moonW} N.`});
  });
}

function addForcesSet(){
  const scenarios = [
    {q:"Two identical sheets dropped: one flat, one crumpled. Which lands first and why?", a:"Crumpled: less air resistance (smaller area)."},
    {q:"Why do car tyres have treads?", a:"Increase friction by channeling water and increasing grip."},
    {q:"How does lubrication affect machine parts?", a:"Reduces friction → less heat/wear, higher efficiency."},
    {q:"Why does a heavy backpack feel lighter with a waist belt?", a:"Redistributes load, increases normal force on hips, reducing shoulder strain."}
  ];
  scenarios.forEach((s,i)=>{
    QUESTIONS.push({id:`5.2-R-${i}`,unit:5,topic:"5.2 Effects of forces",type:"reason",difficulty:"medium",question:s.q,answer:s.a,explanation:"Friction/forces concepts."});
  });
  const mcq = [
    {q:"Which change increases elastic energy in a spring toy most?",opts:["Smaller pull-back","Pull back further (elastic limit)","Heavier body","Worn wheels"],ans:1,exp:"More extension within elastic limit stores more energy."},
    {q:"Which is a balanced-force situation?",opts:["Ball speeding up","Box moving at constant speed on level floor","Stone falling","Rocket launching"],ans:1,exp:"Net force zero → constant velocity."},
  ];
  mcq.forEach((m,i)=>{
    QUESTIONS.push({id:`5.2-M-${i}`,unit:5,topic:"5.2 Effects of forces",type:"mcq",difficulty:"medium",question:m.q,options:m.opts,answer:m.ans,explanation:m.exp});
  });
}

function addFloatingSet(){
  const densities = ["freshwater","seawater (denser)","salt solution (very dense)"];
  densities.forEach((d,i)=>{
    QUESTIONS.push({id:`5.3-M-${i}`,unit:5,topic:"5.3 Floating & sinking",type:"mcq",difficulty:"medium",
      question:`In which liquid would a person float the highest?`,
      options:["Freshwater","Seawater","Tap water","Boiled water"],answer:1,explanation:"Higher density → greater upthrust."});
  });
  const why = [
    "Reshaping clay into a boat increases displaced volume → more upthrust.",
    "Dead Sea has higher salt content → higher density → more upthrust.",
    "Adding foam to a raft increases volume without much mass → lower average density."
  ];
  why.forEach((a,i)=>{
    QUESTIONS.push({id:`5.3-R-${i}`,unit:5,topic:"5.3 Floating & sinking",type:"reason",difficulty:"high",question:"Explain one way to make a heavy object float without changing its material.",answer:a,explanation:"Displacement / density principle."});
  });
}

function addCircuitsSet(){
  const seriesAdds = [1,2,3];
  seriesAdds.forEach((n,i)=>{
    QUESTIONS.push({id:`5.4-S-${i}`,unit:5,topic:"5.4 Circuits & diagrams",type:"short",difficulty:"medium",
      question:`In a series circuit with two identical bulbs, you add ${n} more identical bulb(s). What happens to brightness? Explain.`,
      answer:"All bulbs become dimmer as total resistance increases and current decreases.",explanation:"Series current same through all; more R → less I."});
  });
  const mcq = [
    {q:"Why are home lights wired in parallel?",o:["Cheaper","Each gets full voltage and works independently","Brighter colors","Safer to touch live wire"],a:1,exp:"Parallel gives full supply and independence."},
    {q:"Which fault is LEAST likely if a closed circuit will not light a bulb?",o:["Dead cell","Open switch","Broken filament","Loose connection"],a:1,exp:"If switch is closed, other faults more likely."},
  ];
  mcq.forEach((m,i)=>QUESTIONS.push({id:`5.4-M-${i}`,unit:5,topic:"5.4 Circuits & diagrams",type:"mcq",difficulty:"medium",question:m.q,options:m.o,answer:m.a,explanation:m.exp}));
}

function addMaterialsSets(){
  const pairs = [
    ["Window pane","glass","transparent, rigid"],
    ["Pan base","aluminium","good thermal conductor"],
    ["Pan handle","wood","thermal insulator"],
    ["Electrical wire core","copper","excellent conductor"],
    ["Wire jacket","PVC","electrical insulator"],
  ];
  pairs.forEach((p,i)=>{
    QUESTIONS.push({id:`2.1-S-${i}`,unit:2,topic:"2.1 Properties of substances",type:"short",difficulty:"medium",question:`State a suitable material for the ${p[0]} and one property that justifies it.`,answer:`${p[1]} – ${p[2]}.`,explanation:"Match property to use."});
  });
  const cond = [
    {q:"Best tip material for soldering iron?",o:["Copper","Rubber","Glass","Wood"],a:0,exp:"Copper conducts heat well."},
    {q:"Which item is safest as plug casing?",o:["Metal","Plastic","Wet cotton","Graphite"],a:1,exp:"Plastic insulates."}
  ];
  cond.forEach((m,i)=>QUESTIONS.push({id:`2.2-M-${i}`,unit:2,topic:"2.2 Thermal & electrical conductors",type:"mcq",difficulty:"medium",question:m.q,options:m.o,answer:m.a,explanation:m.exp}));
}

function addReversibleChemicalSets(){
  const rev = [
    {q:"Which change is reversible?",o:["Burning fuel","Melting chocolate","Rusting","Baking cake"],a:1,exp:"Melting/freezing reversible."},
    {q:"Best way to separate sand from salt solution?",o:["Filtration","Evaporation only","Magnet","Chromatography"],a:0,exp:"Sand insoluble → filter first."}
  ];
  rev.forEach((m,i)=>QUESTIONS.push({id:`2.3-M-${i}`,unit:2,topic:"2.3 Reversible changes",type:"mcq",difficulty:"medium",question:m.q,options:m.o,answer:m.a,explanation:m.exp}));
  const chem = [
    {q:"Evidence that a chemical reaction occurred when vinegar meets baking soda.",a:"Gas (CO₂) bubbles form; temperature change; new substances produced."},
    {q:"Explain one method to reduce rusting on a bicycle chain.",a:"Oil/grease forms barrier to oxygen/water, reducing corrosion."}
  ];
  chem.forEach((c,i)=>QUESTIONS.push({id:`2.4-R-${i}`,unit:2,topic:"2.4 Chemical changes",type:"reason",difficulty:"high",question:c.q,answer:c.a,explanation:"Chemical change indicators."}));
}

// Build
addMassWeightSet();
addForcesSet();
addFloatingSet();
addCircuitsSet();
addMaterialsSets();
addReversibleChemicalSets();

// Ensure we have at least 130 questions
(function pad(){
  let i=0; while(QUESTIONS.length<130){
    QUESTIONS.push({id:`FILL-${i++}`,unit:5,topic:"5.2 Effects of forces",type:"mcq",difficulty:"medium",
      question:"Which action mainly reduces air resistance on a cyclist?",
      options:["Wider handlebars","Upright posture","Streamlined helmet and tucked posture","Heavier bike"],answer:2,explanation:"Streamlining reduces drag."});
  }
})();

// ==== UI Logic (similar to earlier version) ====
const ui = {
  mode: document.getElementById('mode'),
  unit: document.getElementById('unit'),
  topic: document.getElementById('topic'),
  difficulty: document.getElementById('difficulty'),
  count: document.getElementById('count'),
  search: document.getElementById('search'),
  generate: document.getElementById('generate'),
  shuffle: document.getElementById('shuffle'),
  print: document.getElementById('print'),
  exportPdf: document.getElementById('exportPdf'),
  paper: document.getElementById('paper'),
  score: document.getElementById('score'),
  timer: document.getElementById('timer'),
  answered: document.getElementById('answered'),
  showAll: document.getElementById('showAll'),
  reset: document.getElementById('reset'),
};

function seedTopics(){
  ui.topic.innerHTML = '<option value="all">All Topics</option>';
  const unit = ui.unit.value;
  if(unit === '2' || unit==='5'){
    TOPICS[unit].forEach(t=>{
      const opt = document.createElement('option');
      opt.value = t; opt.textContent = t; ui.topic.appendChild(opt);
    })
  }
}

function pick(arr,n){
  const a = [...arr];
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a.slice(0, n);
}

function filterQuestions(){
  const unit = ui.unit.value;
  const topic = ui.topic.value;
  const diff = ui.difficulty.value;
  const kw = ui.search.value.trim().toLowerCase();
  return QUESTIONS.filter(q=>{
    if(unit!=='all' && String(q.unit)!==unit) return false;
    if(topic!=='all' && q.topic!==topic) return false;
    if(diff!=='all' && q.difficulty!==diff) return false;
    if(kw && !(q.question.toLowerCase().includes(kw) || (q.explanation||'').toLowerCase().includes(kw))) return false;
    return true;
  });
}

let clock=null, seconds=0, answered=0, currentSet=[];
function startTimer(){ if(clock) clearInterval(clock); seconds=0; clock=setInterval(()=>{seconds++; ui.timer.textContent=new Date(seconds*1000).toISOString().substr(14,5)},1000); }
function stopTimer(){ if(clock) clearInterval(clock); }

function renderPaper(){
  const mode = ui.mode.value;
  const max = Math.min(parseInt(ui.count.value||25,10), 80);
  const pool = filterQuestions();
  currentSet = pick(pool, Math.min(max, pool.length));
  ui.paper.innerHTML = '';
  ui.score.textContent = '0'; answered=0; ui.answered.textContent='0';
  if(mode==='quiz') startTimer(); else stopTimer();

  currentSet.forEach((q,idx)=>{
    const card = document.createElement('div'); card.className='qcard '+q.type;
    const number = idx+1;
    const meta = `<span class="qmeta">#${number} • <span class="tag">${q.topic}</span> • <span class="pill">${q.difficulty.toUpperCase()}</span> • <span class="pill">${q.type}</span></span>`;
    const head = `<div class="qhead"><div>${meta}</div></div>`;
    const qtext = `<div class="qtext">${q.question}</div>`;

    let body='';
    if(q.type==='mcq'){
      const opts = q.options.map((opt,i)=>{
        const name = `q-${q.id}`;
        return `<label class="opt"><input type="radio" name="${name}" value="${i}"> <div>${String.fromCharCode(65+i)}. ${opt}</div></label>`;
      }).join('');
      body = `<div class="opts">${opts}</div>`;
    } else if(q.type==='classify'){
      body = `<div class="print-note">Write your classification, then click “Reveal Answer”.</div>`;
    } else {
      body = `<textarea rows="3" style="width:100%;background:#081028;color:var(--text);border:1px solid #1f2a44;border-radius:12px;padding:10px" placeholder="Type your answer here..."></textarea>`;
    }

    const ans = document.createElement('div'); ans.className='ans hidden';
    const model = (q.type==='mcq') ? `Correct: <strong>${String.fromCharCode(65+q.answer)}</strong>` : `<strong>Model Answer</strong>:`;
    const modelDetail = (q.type==='classify') ? `<pre style="white-space:pre-wrap">Conductors: ${q.answer.conductors.join(', ')}\nNon-conductors: ${q.answer.nonconductors.join(', ')}</pre>`
                      : (q.type==='mcq') ? ''
                      : `<div>${q.answer}</div>`;
    ans.innerHTML = `${model}<div style="margin-top:6px">${modelDetail}</div><div style="margin-top:6px;color:#93c5fd">Explanation: ${q.explanation||''}</div>`;

    const checkBtn = document.createElement('button'); checkBtn.textContent='Check';
    checkBtn.addEventListener('click',()=>{
      if(!ans.classList.contains('hidden')) return;
      let correct = false;
      if(q.type==='mcq'){
        const chosen = card.querySelector('input[type=radio]:checked');
        if(!chosen){ alert('Select an option first.'); return; }
        correct = Number(chosen.value)===q.answer;
      } else {
        correct = null; // open response
      }
      ans.classList.remove('hidden');
      if(correct===true){ ans.classList.add('good'); ans.innerHTML = `<div class="ans good">✅ Correct! ${ans.innerHTML}</div>`; ui.score.textContent = String(Number(ui.score.textContent)+1); }
      else if(correct===false){ ans.classList.add('bad'); ans.innerHTML = `<div class="ans bad">❌ Not quite. ${ans.innerHTML}</div>`; }
      answered++; ui.answered.textContent = String(answered);
    });

    const revealBtn = document.createElement('button'); revealBtn.textContent='Reveal Answer'; revealBtn.className='ghost';
    revealBtn.addEventListener('click',()=>{ ans.classList.remove('hidden'); });

    const actions = document.createElement('div'); actions.className='actions';
    actions.appendChild(checkBtn); actions.appendChild(revealBtn);

    card.innerHTML = head + qtext + body;
    card.appendChild(actions);
    card.appendChild(ans);

    ui.paper.appendChild(card);
  });
}

ui.generate.addEventListener('click', renderPaper);
ui.shuffle.addEventListener('click', ()=>{ renderPaper(); });
ui.print.addEventListener('click', ()=>{ window.print(); });
ui.unit.addEventListener('change', seedTopics);
ui.showAll.addEventListener('click', ()=>{ document.querySelectorAll('.ans.hidden').forEach(x=>x.classList.remove('hidden')); });
ui.reset.addEventListener('click', ()=>{ ui.paper.innerHTML=''; ui.score.textContent='0'; ui.answered.textContent='0'; stopTimer(); ui.timer.textContent='00:00'; });

// === New: Export Model Answer Sheet PDF ===
ui.exportPdf.addEventListener('click', ()=>{
  if(!currentSet.length){ renderPaper(); }
  const w = window.open('', '_blank');
  const style = `
    <style>
      body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;}
      h1{font-size:20px;margin:0 0 4px}
      h2{font-size:14px;margin:0 0 16px;color:#444}
      .q{margin:0 0 14px;padding:10px 12px;border:1px solid #ddd;border-radius:12px}
      .meta{font-size:12px;color:#555;margin-bottom:6px}
      .ans{background:#f8fafc;border-left:4px solid #06b6d4;padding:8px 10px;border-radius:8px;margin-top:6px}
      @media print{.pagebreak{page-break-after:always}}
    </style>`;
  const now = new Date().toLocaleString();
  const htmlTop = `<h1>Model Answer Sheet – Cambridge Primary Science (Units 2 & 5)</h1><h2>Generated: ${now}</h2>`;
  const blocks = currentSet.map((q,i)=>{
    const head = `<div class="meta">#${i+1} • ${q.topic} • ${q.difficulty.toUpperCase()} • ${q.type}</div>`;
    const qtext = `<div><strong>Q:</strong> ${q.question}</div>`;
    let ans = '';
    if(q.type==='mcq'){
      const letters = ['A','B','C','D'];
      const opts = q.options.map((o,j)=>`${letters[j]}. ${o}`).join('<br>');
      ans = `<div style="margin-top:6px">${opts}</div><div class="ans"><strong>Answer:</strong> ${letters[q.answer]}<br><em>Why:</em> ${q.explanation||''}</div>`;
    } else if(q.type==='classify'){
      ans = `<div class="ans"><strong>Model Classification</strong><br>Conductors: ${q.answer.conductors.join(', ')}<br>Non-conductors: ${q.answer.nonconductors.join(', ')}<br><em>Why:</em> ${q.explanation||''}</div>`;
    } else {
      ans = `<div class="ans"><strong>Model Answer:</strong> ${q.answer}<br><em>Why:</em> ${q.explanation||''}</div>`;
    }
    return `<div class="q">${head}${qtext}${ans}</div>`;
  }).join('\n');
  w.document.write(`<html><head><meta charset="utf-8">${style}</head><body>${htmlTop}${blocks}</body></html>`);
  w.document.close();
  w.focus();
  w.print();
});

// init
seedTopics();
renderPaper();
</script>
</body>
</html>
